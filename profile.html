<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Digital Resume</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f4f4f9; }
        .nav { text-align: center; margin-bottom: 30px; }
        .nav a { margin: 0 15px; text-decoration: none; color: #007bff; font-weight: bold; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 100px; font-family: sans-serif; }
        button { width: 100%; padding: 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; margin-top: 20px; }
        .upload-box { background-color: #e9ecef; border: 2px dashed #ced4da; padding: 20px; text-align: center; }
        .upload-btn { background-color: #007bff; width: auto; padding: 10px 20px; font-size: 16px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="index.html">Search</a> | <strong>Profile</strong> | <a href="write.html">Grant Writer</a>
    </div>

    <div class="section upload-box">
        <h3>üöÄ Upload Resume / Business Plan</h3>
        <p>Select a PDF to auto-fill your profile.</p>
        <input type="file" id="resumeFile" accept="application/pdf">
        <br>
        <button class="upload-btn" onclick="uploadResume()">üìÇ Read PDF & Auto-Fill</button>
        <p id="uploadStatus"></p>
    </div>

    <div class="section">
        <label>Your Email</label>
        <input type="email" id="email" placeholder="e.g. aloha@example.com">
        <label>Full Name / Business Name</label>
        <input type="text" id="full_name">
        <label>Personal Statement (Your Story)</label>
        <textarea id="personal_statement"></textarea>
        <label>Key Details / Achievements</label>
        <textarea id="extracurriculars"></textarea>
        <button onclick="saveProfile()">Save Profile</button>
        <p id="status"></p>
    </div>

    <script>
        async function uploadResume() {
            const file = document.getElementById('resumeFile').files[0];
            const status = document.getElementById('uploadStatus');
            if (!file) return alert("Select a PDF first!");
            
            const formData = new FormData();
            formData.append('resume', file);
            status.innerText = "Reading PDF...";
            
            try {
                const res = await fetch('/api/upload-resume', { method: 'POST', body: formData });
                const data = await res.json();
                if (data.success) {
                    document.getElementById('personal_statement').value = data.text;
                    status.innerText = "‚úÖ Done! Text extracted below.";
                } else { status.innerText = "‚ùå Error reading PDF."; }
            } catch(e) { status.innerText = "‚ùå Upload failed."; }
        }

        async function saveProfile() {
            const data = {
                email: document.getElementById('email').value,
                full_name: document.getElementById('full_name').value,
                personal_statement: document.getElementById('personal_statement').value,
                extracurriculars: document.getElementById('extracurriculars').value,
                current_gpa: "N/A", education_level: "Business", major_of_interest: "Housing"
            };
            const status = document.getElementById('status');
            status.innerText = "Saving...";
            
            const res = await fetch('/api/save-profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            if(result.success) status.innerText = '‚úÖ Saved! Ready for Grant Writer.';
            else status.innerText = '‚ùå Error: ' + result.error;
        }
    </script>
</body>
</html>